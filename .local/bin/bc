#!/bin/dash

# bc is a script that if enabled it will limit the charge of your battery to 60% on laptops
# with the kernel module loaded, like in my laptop, a ThinkBook 15-iml.

if [ $1 = 'enable' ]; then
	pkexec bash -c 'echo 1 > /sys/bus/platform/drivers/ideapad_acpi/VPC2004:00/conservation_mode'
	notify-send --app-name='Battery Conservation Mode' 'Enabled'
fi

if [ $1 = 'disable' ]; then
	pkexec bash -c 'echo 0 > /sys/bus/platform/drivers/ideapad_acpi/VPC2004:00/conservation_mode'
	notify-send --app-name='Battery Conservation Mode' 'Disabled'
fi

if [ -z $1 ]; then
	kdialog --yesno 'Battery Conservation' --yes-label 'enable' --no-label 'disable'
	if [ $? -eq '1' ]; then
		pkexec bash -c 'echo 0 > /sys/bus/platform/drivers/ideapad_acpi/VPC2004:00/conservation_mode'
	else
		pkexec bash -c 'echo 1 > /sys/bus/platform/drivers/ideapad_acpi/VPC2004:00/conservation_mode'
	fi
fi
