#!/usr/bin/env bash

governor=powersave

gov_check() {
    actual_governor=$(cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor)
    if [[ "$actual_governor" == "$governor" ]]; then
        echo "Governor has already been set"
    else
        echo "$governor" | sudo tee /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor
    fi
}

case "${1}" in
  performance)
        gdbus call --system --dest net.hadess.PowerProfiles --object-path /net/hadess/PowerProfiles --method org.freedesktop.DBus.Properties.Set 'net.hadess.PowerProfiles' 'ActiveProfile' "<'performance'>"
        governor=performance
        gov_check
    ;;

  balanced)
        kdbus call --system --dest net.hadess.PowerProfiles --object-path /net/hadess/PowerProfiles --method org.freedesktop.DBus.Properties.Set 'net.hadess.PowerProfiles' 'ActiveProfile' "<'balanced'>"
        gov_check
    ;;

  saver)
        gdbus call --system --dest net.hadess.PowerProfiles --object-path /net/hadess/PowerProfiles --method org.freedesktop.DBus.Properties.Set 'net.hadess.PowerProfiles' 'ActiveProfile' "<'power-saver'>"
        gov_check
    ;;
  *)
        gdbus introspect --system --dest net.hadess.PowerProfiles --object-path /net/hadess/PowerProfiles | awk 'sub(/readwrite s */,X)'
        cat /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor
    ;;
esac
